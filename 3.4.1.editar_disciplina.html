<!DOCTYPE html>
<html lang="pt-BR">
  <head>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CadEdu- Editar Disciplina</title>
    <link rel="stylesheet" href="style.css" />

  </head>

  <body>
    <header class="top-header">
      <div class="CadEdu">
        <h1>CadEdu</h1>
      </div>
      <div class="logout">
        <a href="1.login.html"><h1>Sair</h1></a>
      </div>
    </header>

    <aside class="sidebar">
        <div class="sidebar-elements">
          <a href="3.menu.html" class="sidebar-elements-href">Menu</a>
        </div>
        <div class="sidebar-elements">
          <a href="4.cadastrar.html" class="sidebar-elements-href">Cadastrar Informações</a>
        </div>
      </aside>

    <main class="main">
      <div class="section">
        <h1>Editar Disciplina</h1>
      </div>

      <div class="input-info">
        <h1>Nome da Disciplina</h1>
        <div class="forms">
        <input type= "text" id="disc" name="disc" required>

        <h1>Carga Horária</h1>
        <div class="forms">
        <input type= "text" id="ch" name="ch" required>

        <h1>Séries Relacionadas</h1>
        <select id="serie" name="serie" class="dropdown-select" required>
          <option value="">Selecione uma série</option>
        </select>

    </div>

    <button class="submit-button" id="editar">Editar</button>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function(){
        fetch("http://localhost:8080/serie/cadastradas")
        .then(response => response.json())
        .then(data =>{
          let dropdown = document.getElementById("serie");

          data.forEach(serie => {
            let option = document.createElement("option");
            option.value= serie.id;
            option.textContent=  `${serie.serie}${serie.turma} - ${serie.nivelEnsino}`;
            dropdown.appendChild(option);
          });

        })

        .catch(error => console.error("Erro ao carregar séries:", error));
              
      })


      const params = new URLSearchParams(window.location.search);
      const disciplinaId = params.get("id");

      console.log(disciplinaId);

      document.addEventListener("DOMContentLoaded", function () {
        fetch(`http://localhost:8080/disciplina/${disciplinaId}`)
          .then((response) => response.json())
          .then((data) => {
            document.getElementById('disc').value = data.disc;
            document.getElementById('ch').value = data.ch;
            // document.getElementById('serie').value = `${data.serie.serie}${data.serie.turma} - ${data.serie.nivelEnsino}`;

            // 3. Encontra a opção que tem o mesmo texto da série da disciplina
            let serieTexto = `${data.serie.serie}${data.serie.turma} - ${data.serie.nivelEnsino}`;
            let dropdown = document.getElementById("serie");
            let options = dropdown.options;

            for (let i = 0; i < options.length; i++) {
                if (options[i].textContent === serieTexto) {
                    dropdown.selectedIndex = i;
                    break;
                }
            }
          })

          .catch((error) => console.error("Erro ao carregar disciplina:", error));
      });

      // document.getElementById('editar').addEventListener("click", ()=>{
      //   const disciplinaEditada= {
      //     disc: document.getElementById('disc').value,
      //     ch: document.getElementById('ch').value,
      //     serie:{ id: document.getElementById('serie').value }
      //   }

      //   fetch(`http://localhost:8080/disciplina/editar/${disciplinaId}`, {
      //   method: "PUT", // HTTP method
      //   headers: {
      //       "Content-Type": "application/json" // Specify the content type
      //   },
      //   body: JSON.stringify(disciplinaEditada) // Convert data to JSON string
      // }).then(r => {
      //   console.log(disciplinaEditada)
      //   alert("Disciplina editada com sucesso!")
      // })

      // })



    </script>



  </body>
</html>